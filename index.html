<!DOCTYPE html>
<html lang="en">
  <head>

    <!-- Basic Page Needs -->
    <meta charset="utf-8">
    <title>DIXSEE!</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Mobile Specific Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="css/custom.css">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/faveicon.ico">

    <link rel="stylesheet" href="css/pure-min.css">

    <style>
      .result > div > p {
	  margin:0;
      }
    </style>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>

  </head>

  <body class="code-snippets-visible">
    <!-- Primary Page Layout -->
    <div class="container">
      
      <div style="margin-top:0;">

	<div id="splash" onclick="hide_splash()">
	  <div class="row">
	    <div class="twelve columns value-prop">
	      <br>
	      <p style="margin:0;">----------------------------------------------</p>
	      <h5>Find the word!</h5>

	      <p>With each guess, you'll learn if the secret word is
		alphabetically before or after your guess. You'll also see
		the distance between the secret word and your guess.</p>

	      <h5>How does distance work?</h5>
	      <p><a href="https://en.wikipedia.org/wiki/Levenshtein_distance" style="color:black;" target="_blank" rel="noopener noreferrer">Distance
		  between words</a> measures the minimum number of letter
		insertions, deletions, and replacements to turn one word
		into another:</p>
	      <h3>
		<pre class="asciiart" style="text-align:center;">
<span style="color:red;">-</span>i<span style="color:red;">llu</span>mi<span style="color:red;">ne</span>d        kisse<span style="color:red;">d</span>
<span style="color:red;">t</span>i<span style="color:red;">---</span>mi<span style="color:red;">--</span>d        kisse<span style="color:red;">s</span></pre>
	      </h3>
	      <p>"illuminated" and "timid" have a distance of 6
		(insert the <span style="color:red;">t</span>, remove <span style="color:red;">llu</span>, remove <span style="color:red;">ne</span>).<br>
		"kissed" and "kisses" have a distance of 1 (replace
		<span style="color:red;">d</span>→<span style="color:red;">s</span>).</p>

	      <h5>Using distance, you can do cool things:</h5>
	      <p>If the word is between "illness" and "illumined",
	      then it must start "ill...". If guess ill has distance
	      6, then the word must be 9 letters long. Or if the short
	      guess "i" has distance 8 and "a" has distance 9, then
	      the word must contain "i", not contain "a", and has
	      length 9. You can use the distances of your guesses in
	      clever ways to get better and better!</p>

	      <h5 style='margin-top:10px;'>Don't worry about case-- it doesn't matter (proper nouns are excluded).</h5>

	      <h5 style='margin-top:10px;'>And if you get stuck, you can always click the <button>?</button> button to get a hint!</h5>
	      <h5 style='margin-top:20px; text-align:center;'>(click me to dismiss)</h5>
	    </div>
	  </div>
	</div>

	<div id="about_splash" onclick="hide_about_splash()">
	  <div class="row">
	    <div class="one columns"></div>
	    <div class="eleven columns value-prop">
	      <br>
	      <p style="margin:0;">----------------------------------------------</p>
	      <h5>About DIXSEE</h5>
	      <p>DIXSEE is a word game that combines the simplicity of <a href="https://www.nytimes.com/games/wordle/index.html" style="color:black;" target="_blank" rel="noopener noreferrer">Wordle</a> with the challenge of <a href="https://semantle.com" style="color:black;"  target="_blank" rel="noopener noreferrer">Semantle</a>.</p>

	      <h5>Is DIXSEE free?</h5>
	      <p>100%!</p>

	      <h5>Do you sell the words I enter to advertisers?</h5>
	      <p>Nope. Those are only held locally (on your computer).</p>

	      <h5>Why did you make DIXSEE?</h5>
	      <p>What started out as a quick project for my wife became a game that we play regularly. We'd love to share it with you!</p>

	      <p style="text-align:center;"><img src="images/large-atom.png"
		style="width:25%;"><br>My name is Oliver. My lovely wife drew this atom for me!</p>
	      <h5 style='margin-top:20px; text-align:center;'>(click me to dismiss)</h5>
	    </div>
	  </div>
	</div>

	<div id="page">
	  <br>
	  <div id="share" class="row">
	    <!-- facebook: -->
	    <div class="two columns value-prop">
	      <!-- Load Facebook SDK for JavaScript -->
	      <div id="fb-root"></div>
	      <script>(function(d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) return;
		js = d.createElement(s); js.id = id;
		js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0";
		fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>

	      <!-- Your share button code -->
	      <div class="fb-share-button"
		   data-href="https://dixsee.github.io"
		   data-layout="button_count">
	      </div>
	    </div>

	    <!-- twitter: -->
	    <!-- pad by 4px to match whitespace on facebook: -->
	    <div class="two columns value-prop" style="padding-top:4px;">
	      <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-text="Play #DIXSEE with me!" data-url="https://dixsee.github.io" data-show-count="false">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
	    </div>
	    
	  </div>
	  
	  <div id="row_dixsee" class="row">
	    <div class="twelve columns value-prop">
	      <br>
	      <p style="margin:0;">----------------------------------------------</p>
	      <pre id="dixsee" class="asciiart">
██████╗ ██╗██╗  ██╗███████╗███████╗███████╗██╗
██╔══██╗██║╚██╗██╔╝██╔════╝██╔════╝██╔════╝██║
██║  ██║██║ ╚███╔╝ ███████╗█████╗  █████╗  ██║
██║  ██║██║ ██╔██╗ ╚════██║██╔══╝  ██╔══╝  ╚═╝
██████╔╝██║██╔╝ ██╗███████║███████╗███████╗██╗
╚═════╝ ╚═╝╚═╝  ╚═╝╚══════╝╚══════╝╚══════╝╚═╝</pre>
	      <p id="score">&nbsp;</p>
	    </div>
	  </div>

	  <div class="row">
	    <div class="four columns value-prop"></div>

	    <div class="seven columns value-prop" style="text-align:center;">
	      <!-- the symbol is an open book: -->
	      <h4><span id="left"></span> &lt; 📖 &lt; <span id="right"></span></h4>
	      <br>
	    </div>
	  </div>

	  <div class="row">
	    <div class="two columns value-prop"></div>

	    <div class="six columns value-prop">
	      <input id="guess" type="text" placeholder='Guess!' style="width:100%; font-size:18pt;">
	  </input>
	    </div>

	    <div class="three columns value-prop">
	      <button onclick="submit()">Submit</button>
	    </div>
	    <div class="one columns value-prop">
	      <button id="hint" onclick="hint()">?</button>
	    </div>

	  </div>

	  <br>

	  <div class="row">
	    <div class="two columns value-prop"></div>
	    <div class="ten columns value-prop" style="text-align:left;">
	      <p style="margin:0;">----------------------------------------------</p>
	    </div>
	  </div>

	  <div class="row">
	    <div class="two columns value-prop"></div>

	    <div class="four columns value-prop">
	      <h5><a href="#" style="color:black;" onclick="show_splash()">DISTANCE</a></h5>
	    </div>
	    <div class="six columns value-prop">
	      <h5>GUESS</h5>
	    </div>
	  </div>

	  <div id="guesses">
	  </div>

	  <div id="footer">
	    <div><p><a href="#" style="color:black;" onclick="show_about_splash();">ABOUT DIXSEE</a> / <a href="#" style="color:black;" onclick="show_splash();">HOW TO PLAY</a> / © 2023, ALL RIGHTS RESERVED</p></div>
	  </div>
	</div>

      </div>
    <br>
    <!-- End Document -->

  </body>
  
  <!--Scripts-->
  <!-- <script type="text/javascript" src="js/everything.js"></script> -->

  <script type="text/javascript">
    function show_about_splash() {
	$('#about_splash').show();
    }

    function hide_about_splash() {
	$('#about_splash').hide();
	$('#guess').focus();
    }

    function show_splash() {
	$('#splash').show();
    }

    function hide_splash() {
	$('#splash').hide();
	$('#guess').focus();
    }

    // start a new game:
    function reset() {
	// secret word:
	// exclude first and last words in the dictionary to avoid
	// edge case with left and right bounds:
	var x = window.words[ Math.floor(Math.random()*(window.words.length-2))+1 ];
	window.guesses = [];

	window.left = words[0];
	window.right = words[words.length-1];
	$('#left').text(window.left);
	$('#right').text(window.right);

	$('#guesses').empty();

	$('#guess').val('');

	// hide x instead of using window.x:
	partial_lt_x = function(g) {
	    return g < x;
	};

	partial_levenshtein = function(g) {
	    return levenshtein(g, x);
	};
	
	window.n_hints = 0;
	window.n_guesses = 0;
    }

    // allow enter key to submit:
    $("#guess").keypress(function(e) {
	// if the key pressed is the enter key
	if (e.which == 13) {
	    submit();
	}
    });

    function levenshtein(a, b) {
	var t = [], u, i, j, m = a.length, n = b.length;
	if (!m) { return n; }
	if (!n) { return m; }
	for (j = 0; j <= n; j++) { t[j] = j; }
	for (i = 1; i <= m; i++) {
	    for (u = [i], j = 1; j <= n; j++) {
		u[j] = a[i - 1] === b[j - 1] ? t[j - 1] : Math.min(t[j - 1], t[j], u[j - 1]) + 1;
	    } t = u;
	} return u[n];
    }

    function hint() {
	window.n_hints++;
	
	// binary search unnecessary for <100k compared to animations of submit():
	ind_left = window.words.indexOf(window.left);
	ind_right = window.words.indexOf(window.right);
	
	// exclude left and right (so -2 and shift range by +1):
	g = window.words[ ind_left + Math.floor(Math.random() * (ind_right-ind_left-2)) + 1 ];
	$('#guess').val(g);
	
	submit();
    }

    function isSuperset(set, subset) {
	for (const elem of subset) {
	    if (!set.has(elem)) {
		return false;
	    }
	}
	return true;
    }

    alphabet_set = new Set('abcdefghijklmnopqrstuvwxyz')

    // NOTE: doesn't work locally; for that, use raw link to bitbucket file american-english.
    fetch('./media/american-english')
    .then(response => response.text())
    .then((words_file) => {
	// clean out punctuation, etc.:
	words = words_file.split('\n').filter( w => w.length>0 && isSuperset(alphabet_set, new Set(w)) );
	// already sorted:
	//words.sort();
	
	window.words = words;
	window.words_set = new Set(words);

	reset();

	if (document.cookie == '') {
	    $('#splash').show();
	    document.cookie = 'visited';
	}
    })

    function winner() {
	$('#hint').prop('disabled',true);

	$('#score').text('Found "' + $('#guess').val() + '" in ' + window.n_guesses + ' tries & ' + window.n_hints + ' hints')

	$('#dixsee').animate({
	    'color':'#0f0'
	}, 2000, complete=function(){
	    $('#dixsee').animate({
		'color':'#000'
	    }, 1000, complete=function() {
		reset();
	    });
	});

	setTimeout('$("#hint").removeAttr("disabled")', 3000);
    }

    function add_guess(g) {
	// add to count if new guess:
	if (! new Set(window.guesses).has(g) )
	    window.n_guesses++;
	// add submission to list, regardless:
	window.guesses.push(g);

	var color;
	if (dist_leven == 0)
	    color = '#0f0';
	else if (dist_leven == 1)
	    color = '#0a0';
	else if (dist_leven == 2)
	    color = '#080';
	else if (dist_leven == 3)
	    color = '#070';
	else if (dist_leven == 4)
	    color = '#060';
	else if (dist_leven == 5)
	    color = '#050';
	else if (dist_leven == 6)
	    color = '#020';
	else
	    // dist_leven > 6:
	    color = '#000';

	var weight;
	if (dist_leven <= 3)
	    weight = 'bold';
	else
	    weight = 'normal';

	$('#guesses').prepend(
	    '<div class="row result" style="color:'+color+'; font-weight:' + weight + '"><div class="two columns value-prop"></div><div class="four columns value-prop"><p>'+ dist_leven +'</p></div><div class="six columns value-prop"><p>' + g + '</p></div></div>');
    }    

    function submit() {
	var g = $('#guess').val().toLowerCase();
	dist_leven = partial_levenshtein(g)

	if (dist_leven == 0) {
	    add_guess(g);

	    winner();
	}
	else {
	    if (window.words_set.has(g)) {
		if (g > window.left && g < window.right) {
		    // guess splits range:
		    if (partial_lt_x(g)) {
			window.left = g;
			$('#left').text(window.left);
		    }
		    else {
			// g > x:
			window.right = g;
			$('#right').text(window.right);
		    }
		}

		add_guess(g);

		// clear guess:
		$('#guess').val('');
	    }
	    else {
		// not a valid word:
		$('#guess').animate({
		    'background-color':'#f00'
		}, 250, complete=function(){
		    $('#guess').animate({
			'background-color':'#fff'
		    }, 10);
		});
	    }
	}

	// restore focus to #guess after mouse click for submission/hint:
	$('#guess').focus();
    }
    
  </script>

</html>
